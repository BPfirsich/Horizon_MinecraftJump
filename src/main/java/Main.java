import javafx.animation.AnimationTimer;
import javafx.application.Application;
import javafx.css.Match;
import javafx.scene.Scene;
import javafx.scene.image.Image;
import javafx.scene.layout.*;
import javafx.stage.Stage;

public class Main extends Application {

    private GameDimension _currentDimension = null;
    private InputData _inputData = null;
    private MatchLeben _matchLeben = null;

    private LevelData _overworld_1;
    private LevelData _overworld_2;
    private LevelData _testworld;
    private LevelData _homescreen;

    private BackgroundImage _background_1_1;
    private BackgroundImage _background_1_2;
    private BackgroundImage _homescreen_img;

    @Override
    public void start(Stage stage) {
        // JavaFX Setup
        Pane root = new Pane();
        root.setPrefSize(1280, 720);

        //Scene Menu = new Scene(root);
        //stage.setScene(Menu);


        Scene Level = new Scene(root);
        stage.setScene(Level);
        stage.setTitle("Horizon Minecraft Jump");
        stage.show();


        // Funktionsklassen Setup
        _inputData = new InputData();
        _inputData.initInputSystemOnScene(Level);

        // Hintergründe laden
        _background_1_1 = new BackgroundImage(
                new Image(getClass().getResourceAsStream("/screen_ow_1.png")),
                BackgroundRepeat.NO_REPEAT, // Wiederholung horizontal
                BackgroundRepeat.NO_REPEAT, // Wiederholung vertikal
                BackgroundPosition.CENTER,  // Position
                BackgroundSize.DEFAULT      // Größe
        );

        _background_1_2 = new BackgroundImage(
                new Image(getClass().getResourceAsStream("/screen_ow_2.png")),
                BackgroundRepeat.NO_REPEAT, // Wiederholung horizontal
                BackgroundRepeat.NO_REPEAT, // Wiederholung vertikal
                BackgroundPosition.CENTER,  // Position
                BackgroundSize.DEFAULT      // Größe
        );

        _homescreen_img = new BackgroundImage(
                new Image(getClass().getResourceAsStream("/Homescreen_text.png")),
                BackgroundRepeat.NO_REPEAT, // Wiederholung horizontal
                BackgroundRepeat.NO_REPEAT, // Wiederholung vertikal
                BackgroundPosition.CENTER,  // Position
                new  BackgroundSize(1280, 720, false, false, true, true) // Größe
        );

        // Erstellen der Level
        _overworld_1 = new LevelData("Overworld_1", 12, _background_1_1);
        _overworld_1.stufe[11] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_1.stufe[10] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_1.stufe[9]  = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_1.stufe[8]  = "---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------C-";
        _overworld_1.stufe[7]  = "----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<#####>";
        _overworld_1.stufe[6]  = "------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<####>--<######>-------";
        _overworld_1.stufe[5]  = "---------------------------------------------------------------------------------------------------------------------------------------------------------------------<#####>--<####>--<####>-------------------------------------------------------------------------------<######>-<####>-----------------------";
        _overworld_1.stufe[4]  = "------------------------------------------------------------------------------------------------------------------------------------------------------------<#####>-----------------------------------------------------------------------------------------------<#######>--------------------------------------";
        _overworld_1.stufe[3]  = "---------------------------------------<##########>-------------------------------------<#>-<#>--<#>--<#>------------------------------------------<#####>--------------------------------------------------------------------------------------------<#>-<#>--<#>-----------------------------------------------";
        _overworld_1.stufe[2]  = "------P--------<###>---------------<>--l++++++++++r--<>------------------<#>--<#>--<#>----------------------------------------------------<#####>-------------------------------------------------------------------------------------<##>--<##>--<##>-----------------------------------------------------------";
        _overworld_1.stufe[1]  = "----<###>----<#u+++i##>--------<>--lr--l++++++++++r--lr--<>----------<#>---------------------------------------------------------<#####>----------------------------------------------------------------------------------<>--<>--<>-----------------------------------------------------------------------------";
        _overworld_1.stufe[0]  = "####u+++i####u++++++++i######ww34ww34ww3++++++++++4ww34ww34ww######wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww######ww##w##ww#####wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww#######www###www##www##ww##wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww";

        _overworld_2 = new LevelData("Overworld_2", 15, _background_1_2);
        _overworld_2.stufe[14] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[13] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[12] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[11] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[10] = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[9]  = "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------C--";
        _overworld_2.stufe[8]  = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------s--s--s--8sssss7--8ssssss7--8sssssss7-8ssssssssssssss7";
        _overworld_2.stufe[7]  = "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------s--s--s--------------------------------------------------------";
        _overworld_2.stufe[6]  = "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------s--s--s-----------------------------------------------------------------";
        _overworld_2.stufe[5]  = "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------s--s--s--------------------------------------------------------------------------";
        _overworld_2.stufe[4]  = "---------------------------------------------------------s--s-----------------------------------------------8ssssss7-----------------------------s--s------------------------------------------------------------------s--s--s-----------------------------------------------------------------------------------";
        _overworld_2.stufe[3]  = "-P--------------------------------------------s-------s--------s--s-------------------------------8ssssss7------------------------------s--s--s--------s------------------------------------------------------s--s--s--------------------------------------------------------------------------------------------";
        _overworld_2.stufe[2]  = "--------------------------------------s--s-s----s--s-----------------s-s--s---------8ssssssssss7----------------------s--s--s--------s--------------------s-----------------------s--s--s---------------s--s-----------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[1]  = "sssssssssssssssss--8s7--8s7--8s7--8s7---------------------------------------s--s--s--------------------------------------------s--s--------------------------8ssssss7--8sssssss7-----------s--8s7--8s7-----------------------------------------------------------------------------------------------------------";
        _overworld_2.stufe[0]  = "+++++++++++++++++wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww";


        _testworld = new LevelData("Testlevel", 11, _background_1_1);
        _testworld.stufe[10] = "-----------------------------";
        _testworld.stufe[9]  = "-----------------------------";
        _testworld.stufe[8]  = "-----------------------------";
        _testworld.stufe[7]  = "-----------------------------";
        _testworld.stufe[6]  = "-----------------------------";
        _testworld.stufe[5]  = "-----------------------------";
        _testworld.stufe[4]  = "-----------------------------";
        _testworld.stufe[3]  = "-------------<>--<#####------";
        _testworld.stufe[2]  = "-------------lr--l+++++------";
        _testworld.stufe[1]  = "-P-------<>--lr--l+++++------";
        _testworld.stufe[0]  = "######>--lr--lr--l+++++------";

        _homescreen = new LevelData("Homescreen", 11, _homescreen_img);
        _homescreen.stufe[10] = "-------------------------------------------------------------------";
        _homescreen.stufe[9]  = "-------------------------------------------------------------------";
        _homescreen.stufe[8]  = "-------------------------------------------------------------------";
        _homescreen.stufe[7]  = "-------------------------------------------------------------------";
        _homescreen.stufe[6]  = "-------------------------------------------------------------------";
        _homescreen.stufe[5]  = "-------------------------------------------------------------------";
        _homescreen.stufe[4]  = "-------------------------------------------------------------------";
        _homescreen.stufe[3]  = "-------------------------------------------------------------------";
        _homescreen.stufe[2]  = "-------------------------------------------------------------------";
        _homescreen.stufe[1]  = "----P--------------------------------------------------------------";
        _homescreen.stufe[0]  = "-------------------------------------------------------------------";

        // TESTING ---
        _matchLeben = new MatchLeben(3);
        _currentDimension = new GameDimension("Test", root, _matchLeben);
        //_currentDimension.addGegner(new Gegner(500, 370, 200 ));
        _currentDimension.ladeLevel(_overworld_1);
        // --- TESTING


        // Spielschleife, also quasy das "Herz" des spiels.
        AnimationTimer timer = new AnimationTimer() {
            double lastTimeNano = System.nanoTime();

            @Override
            public void handle(long currentTimeMillis) {
                // Die zeit zwischen diesen und letzten frame berechnen
                float deltaTime = (float)((currentTimeMillis - lastTimeNano) / 1_000_000_000.0);
                lastTimeNano = currentTimeMillis;

                // Alle funktionen callen, die pro frame vorkommen
                _inputData.inputSystemUpdate();
                update(deltaTime * 1);
            }
        };
        timer.start();
    }

    private void update(float deltaTime) {
        _currentDimension.updateDimension(deltaTime, _inputData);
    }

    public static void main(String[] args) {
        launch(args);
    }
}